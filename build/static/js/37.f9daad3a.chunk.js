"use strict";(self.webpackChunklittle_fighter_j=self.webpackChunklittle_fighter_j||[]).push([[37],{3037:(t,e,n)=>{n.r(e),n.d(e,{default:()=>x});var o=n(5043),i=n(3624),s=n(4008);let r;!function(t){function e(t){return t&&!0===t.is_bebavior_node}function n(t){return t&&!0===t.is_bebavior_conn}t.is_node=e,t.is_connection=n;t.Actor=class{constructor(){this.is_debug=!1,this.warn=t=>{},this._behavior=void 0,this._behavior_map=new Map,this._connection_list=new Map}get behavior(){return this._behavior}add_behavior(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];for(const i of n){const t=e(i)?i:i.done();if(this.is_debug){const e=this._behavior_map.get(t.name);e&&e!==t&&this.warn(`behavior name ${JSON.stringify(t.name)} already exists, will replace it.`)}this._behavior_map.set(t.name,t)}return this}find_behavior(t){return this._behavior_map.get(t)}use_behavior(t){var e,n;const o=this.find_behavior(t);if(!o)return this.warn(`behavior name ${JSON.stringify(t)} not found.`),this;const i=this._behavior;return null===i||void 0===i||null===(e=i.on_leave)||void 0===e||e.call(i,o,i),this._behavior=o,null===(n=o.on_enter)||void 0===n||n.call(o,i,o),this}add_connection(){for(var t=arguments.length,e=new Array(t),o=0;o<t;o++)e[o]=arguments[o];for(const i of e){const t=n(i)?i:i.done(),{start:e,end:o}=t;this.add_behavior(e,o);let s=this._connection_list.get(e.name);s||this._connection_list.set(e.name,s=[]),s.push(t)}return this}update(t){var e,n;if(!this._behavior)return;null===(e=(n=this._behavior).on_update)||void 0===e||e.call(n,t,this._behavior);const o=this._connection_list.get(this._behavior.name);if(null!==o&&void 0!==o&&o.length)for(const _ of o){var i,s,r,a,h;null!==(i=_.judge)&&void 0!==i&&i.call(_,t,_.start,_.end)&&(null===(s=(r=this._behavior).on_leave)||void 0===s||s.call(r,_,this._behavior),this._behavior=_.end,null===(a=(h=_.end).on_enter)||void 0===a||a.call(h,_,_.end))}}};class o{get_data(){return this._data}get_name(){return this._name}get_context(){return this._on_enter}get_on_enter(){return this._on_enter}get_on_leave(){return this._on_leave}get_on_update(){return this._on_update}actor(t){return this._actor=t,this}on_enter(t){return this._on_enter=t,this}on_leave(t){return this._on_leave=t,this}on_update(t){return this._on_update=t,this}constructor(t,e,n){this._name=void 0,this._data=void 0,this._context=void 0,this._on_enter=void 0,this._on_leave=void 0,this._on_update=void 0,this._actor=void 0,this._name=t,this._data=e,this._context=n}done(){const t={is_bebavior_node:!0,name:this._name,data:this._data,context:this._context,on_enter:this._on_enter,on_leave:this._on_leave,on_update:this._on_update};return this._actor&&this._actor.add_behavior(t),t}}function i(t,e,n){return new o(t,e,n)}t.Noding=i;class s{constructor(t){this._actor=void 0,this._judge=()=>!1,this._start=void 0,this._end=void 0,this._actor=t}get_start(){return this._start?this._start:i("start_not_set")}get_end(){return this._end?this._end:i("end_not_set")}actor(t){return this._actor=t,this}judge(t){return this._judge=t,this}start(t,e,n){return this._start=new o(t,e,n),this}end(t,e,n){return this._end=new o(t,e,n),this}on_start_enter(){return this.get_start().on_enter(...arguments),this}on_start_leave(){return this.get_start().on_leave(...arguments),this}on_start_update(){return this.get_start().on_update(...arguments),this}on_end_enter(){return this.get_end().on_enter(...arguments),this}on_end_leave(){return this.get_end().on_leave(...arguments),this}on_end_update(){return this.get_end().on_update(...arguments),this}done(){var t,e,n,o,i,s,r,a,h,_,d,u;const c=this.get_start(),l=this.get_end(),v=(null===(t=this._actor)||void 0===t?void 0:t.find_behavior(c.get_name()))||c.done(),g=(null===(e=this._actor)||void 0===e?void 0:e.find_behavior(l.get_name()))||l.done();v.data=null!==(n=v.data)&&void 0!==n?n:c.get_data(),v.context=null!==(o=v.context)&&void 0!==o?o:c.get_context(),v.on_enter=null!==(i=v.on_enter)&&void 0!==i?i:c.get_on_enter(),v.on_leave=null!==(s=v.on_leave)&&void 0!==s?s:c.get_on_leave(),v.on_update=null!==(r=v.on_update)&&void 0!==r?r:c.get_on_update(),g.data=null!==(a=g.data)&&void 0!==a?a:l.get_data(),g.context=null!==(h=g.context)&&void 0!==h?h:l.get_context(),g.on_enter=null!==(_=g.on_enter)&&void 0!==_?_:l.get_on_enter(),g.on_leave=null!==(d=g.on_leave)&&void 0!==d?d:l.get_on_leave(),g.on_update=null!==(u=g.on_update)&&void 0!==u?u:l.get_on_update();const p={is_bebavior_conn:!0,start:v,end:g,judge:this._judge};return this._actor&&this._actor.add_connection(p),p}}t.Connecting=function(t){return new s(t)}}(r||(r={}));Math.PI,Math.PI;function a(t,e,n){return Math.max(e,Math.min(n,t))}var h=n(6791);class _{constructor(){this.ground=void 0,this.pos=new h.X.Vector2(0,0),this.name="Creature",this.color="red",this.actor=new r.Actor}update(t){var e,n;this.pos.x=a(this.pos.x,0,(null===(e=this.ground)||void 0===e?void 0:e.size.x)||0),this.pos.y=a(this.pos.y,0,(null===(n=this.ground)||void 0===n?void 0:n.size.y)||0),this.actor.update(t)}render(t){var e,n;(t.fillStyle=this.color,t.font="bold 20px serif",t.textAlign="center",t.textBaseline="middle",t.globalAlpha=1,t.fillText(this.name,this.pos.x,this.pos.y),null!==(e=this.actor.behavior)&&void 0!==e&&e.name)&&(t.font="bold 12px serif",t.globalAlpha=.5,t.fillText(null===(n=this.actor.behavior)||void 0===n?void 0:n.name,this.pos.x,this.pos.y+20))}}let d=function(t){return t.escaping_from_human="escaping from you",t.interested_in_human="interested in you",t.looking_at_human="looking at you",t}({});class u extends _{constructor(){super(),this.human=void 0,this.distance_vector=()=>{var t;return this.pos.clone().sub((null===(t=this.human)||void 0===t?void 0:t.pos)||this.pos)},this.direction=()=>this.distance_vector().normalize(),this.is_too_close=()=>this.distance_vector().length()<100,this.is_too_far=()=>this.distance_vector().length()>200,this.escaping=()=>this.pos.add(this.direction()),this.closing=()=>this.pos.sub(this.direction()),this.name="Cat",this.color="white",this.actor.add_behavior(r.Noding(d.escaping_from_human,this).on_update(t=>this.escaping()),r.Noding(d.interested_in_human,this).on_update(()=>this.closing()),r.Noding(d.looking_at_human,this)),r.Connecting(this.actor).start(d.interested_in_human,1,2).end(d.looking_at_human).judge(()=>!this.is_too_close()&&!this.is_too_far()).done(),r.Connecting(this.actor).start(d.escaping_from_human).end(d.looking_at_human).judge(()=>!this.is_too_close()&&!this.is_too_far()).done(),r.Connecting(this.actor).start(d.looking_at_human).end(d.interested_in_human).judge(()=>this.is_too_far()).done(),r.Connecting(this.actor).start(d.looking_at_human).end(d.escaping_from_human).judge(()=>this.is_too_close()).done(),this.actor.use_behavior(d.looking_at_human)}update(t){var e;super.update(t),this.human=null===(e=this.ground)||void 0===e?void 0:e.creatures.find(t=>"You"===t.name)}}u.BehaviorEnum=d;var c=n(579);const l=100,v=500,g=500,p=new u,f=new _;f.name="You",f.color="white",f.pos.x=v/2,f.pos.y=g/2;var m=function(t){return t.Moving="moving",t.Standing="standing",t}(m||{});r.Noding(m.Standing).actor(f.actor).done(),f.actor.use_behavior(m.Standing),r.Connecting(f.actor).done();const b=new class{constructor(){this.pos=new h.X.Vector2(0,0),this.size=new h.X.Vector2(0,0),this.creatures=new Array}add_creature(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.creatures.push(...e);for(const o of e)o.ground=this}update(t){this.creatures.forEach(e=>e.update(t))}render(t){t.translate(this.pos.x,this.pos.y),t.fillStyle="green",t.fillRect(0,0,this.size.x,this.size.y),this.creatures.forEach(e=>e.render(t))}};function x(){const t=(0,o.useRef)(null),e=(0,o.useRef)(null),n=(0,o.useRef)(!1),r=(0,o.useRef)(0),a=(0,o.useRef)(null),[h]=(0,o.useMemo)(()=>[new s.A],[]);(0,o.useEffect)(()=>{var n;e.current=null===(n=t.current)||void 0===n?void 0:n.getContext("2d")},[]);const _=(0,o.useCallback)(t=>{b.update(t)},[]),d=(0,o.useCallback)(o=>{const i=t.current,s=e.current;if(!i||!s)return;const{width:d,height:u}=i;i.width=d,i.height=u;const c=o-r.current;n.current||_(c),b.render(s),h.update(o-r.current),r.current=o,a.current&&(a.current.innerText=""+Math.floor(h.value))},[_,h]);return(0,o.useEffect)(()=>{var n;e.current=null===(n=t.current)||void 0===n?void 0:n.getContext("2d");const o=i.dB.add(d),s=t=>{f.pos.x=t.offsetX-l,f.pos.y=t.offsetY-l};return document.addEventListener("mousemove",s),()=>{i.dB.del(o),document.removeEventListener("mousemove",s)}},[d]),(0,c.jsx)("div",{children:(0,c.jsx)("canvas",{style:{cursor:"none"},ref:t,width:2*l+v+1,height:2*l+g+1,onContextMenu:t=>t.preventDefault()})})}b.pos.x=l,b.pos.y=l,b.size.x=v,b.size.y=g,b.add_creature(p,f)}}]);
//# sourceMappingURL=37.f9daad3a.chunk.js.map